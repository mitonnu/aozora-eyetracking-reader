(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();const t={localStorage:"aozoraEyetrackingReader",calibrationSettingDialogElement:null,systemSettingDialogElement:null,calibrationInstructionDialogElement:null,scrollUpButtonElement:null,scrollDownButtonElement:null,calibrationRestButtonElement:null,calibrationStartButtonElement:null,calibrationPointerElements:null,systemSettingDialogButton:null,trackingPointerCheckBoxElement:null,cameraPrevievCheckBoxElement:null,scrollButtonDisplayCheckBoxElement:null,splashScreenCheckBoxElement:null,scrollStep:5,trackingPointerDisplay:!0,scrollButtonDisplay:!0,cameraPreviewDisplay:!0,splashScreenDisplay:!0};function a(){window.localStorage.setItem(t.localStorage,JSON.stringify(t))}function c(){return JSON.parse(window.localStorage.getItem(t.localStorage))}function p(){return!!window.localStorage.getItem(t.localStorage)}function y(){s(),t.scrollDownButtonElement=document.querySelector(".j-gaze-scroll-down-button"),t.scrollDownButtonElement.addEventListener("click",e=>{u("down")}),t.scrollUpButtonElement=document.querySelector(".j-gaze-scroll-up-button"),t.scrollUpButtonElement.addEventListener("click",e=>{u("up")}),m(".j-system-setting-dialog",[".j-system-setting-button"],[".j-system-setting-close-button",".j-start-calibration-setting-button"]),m(".j-calibration-instruction-dialog",[".j-start-calibration-setting-button"],[".j-to-calibration-button",".j-start-without-calibration-button"]),m(".j-calibration-dialog",[".j-to-calibration-button"],[".j-calibration-setting-close-button"]),t.trackingPointerCheckBoxElement=document.querySelector("#eyeTrackingPointer"),t.cameraPrevievCheckBoxElement=document.querySelector("#cameraPreview"),t.scrollButtonDisplayCheckBoxElement=document.querySelector("#gazeScrollButton"),t.splashScreenCheckBoxElement=document.querySelector("#splashScreen"),t.trackingPointerCheckBoxElement.checked=c().trackingPointerDisplay,t.cameraPrevievCheckBoxElement.checked=c().cameraPreviewDisplay,t.scrollButtonDisplayCheckBoxElement.checked=c().scrollButtonDisplay,t.splashScreenCheckBoxElement.checked=c().splashScreenDisplay,t.trackingPointerCheckBoxElement.addEventListener("change",e=>{t.trackingPointerDisplay=e.target.checked,a(),s()}),t.scrollButtonDisplayCheckBoxElement.addEventListener("change",e=>{t.scrollButtonDisplay=e.target.checked,a(),s()}),t.cameraPrevievCheckBoxElement.addEventListener("change",e=>{t.cameraPreviewDisplay=e.target.checked,a(),s()}),t.splashScreenCheckBoxElement.addEventListener("change",e=>{t.splashScreenDisplay=e.target.checked,a(),s()}),document.querySelector(".j-calibration-reset").addEventListener("click",()=>{webgazer.clearData(),window.alert("キャリブレーションがリセットされました。")})}function m(n,e,i){const r=document.querySelector(n);e&&[...e].forEach(o=>{document.querySelector(o).addEventListener("click",()=>{g(r,!0)})}),i&&[...i].forEach(o=>{document.querySelector(o).addEventListener("click",()=>{g(r,!1)})})}function g(n,e=!0){e?n.showModal():n.close()}function u(n="down"){const e=t.scrollStep;n==="down"?window.scrollBy({top:+e,behavior:"smooth"}):n==="up"&&window.scrollBy({top:-e,behavior:"smooth"})}function s(){webgazer.showPredictionPoints(c().trackingPointerDisplay),console.log(c().cameraPreviewDisplay),webgazer.showVideo(c().cameraPreviewDisplay)}function f(n){const e=document.querySelector(".l-splash-screen"),i=document.querySelector(".j-model-loading-status");if(n){const r=Date.now(),o=window.setInterval(()=>{let l=Date.now()-r;webgazer.isReady()&&l>2e3&&(i.innerHTML="アイトラッキングモデルの<br>ロードが完了しました",e.classList.add("is-loaded"),window.setTimeout(()=>{e.classList.add("u-visually-hidden"),window.clearInterval(o),document.querySelector(".j-calibration-instruction-dialog").showModal()},1e3))},100)}else e.classList.add("u-visually-hidden")}function h(){t.calibrationPointerElements=document.querySelectorAll(".j-calibration-pointer"),[...t.calibrationPointerElements].forEach(e=>{e.addEventListener("click",i=>{e.classList.add("is-selected");let r=+e.getAttribute("data-selected");r<3&&e.setAttribute("data-selected",r+1),E()&&(document.querySelector(".j-calibration-setting-close-button").disabled=!1)})});const n=document.querySelector(".j-calibration-setting-close-button");n.disabled&&n.addEventListener("click",()=>{console.log("clear start"),b()})}function E(){let n=0;return[...t.calibrationPointerElements].forEach(e=>{e.getAttribute("data-selected")>=3&&(n+=1)}),n>=9}function b(){[...t.calibrationPointerElements].forEach(n=>{n.setAttribute("data-selected",0),n.classList.remove("is-selected"),document.querySelector(".j-calibration-setting-close-button").disabled=!0})}function S(){webgazer.saveDataAcrossSessions(!0)}function w(){const n=B();webgazer.setGazeListener((e,i)=>{e!==null&&D(e,n)}).begin()}function B(){const[n,e]=[...document.querySelectorAll(".j-gaze-target-area")],i=n.getBoundingClientRect(),r=e.getBoundingClientRect();return{scrollUpArea:i,scrollDownArea:r}}function D(n,e){if(e.scrollUpArea.bottom<n.y&&n.y<e.scrollDownArea.top){t.scrollUpButtonElement.classList.add("u-visually-hidden"),t.scrollDownButtonElement.classList.add("u-visually-hidden");return}if(n.y<e.scrollUpArea.bottom){c().scrollButtonDisplay&&t.scrollUpButtonElement.classList.remove("u-visually-hidden"),u("up");return}if(e.scrollDownArea.top<n.y){c().scrollButtonDisplay&&t.scrollDownButtonElement.classList.remove("u-visually-hidden"),u("down");return}}window.onload=()=>{p()||a(),y(),S(),w(),f(c().splashScreenDisplay),h()};
